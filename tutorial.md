# Tutorial

This tutorial has been designed to illustrate several possible use of BASE, which reflect real scenarios of analysis.

---

## Installation and download of the toy dataset:

BASE substantially consists in a wrapper which leverages the following pieces of software:

* Phyutility
* RAxML
* PAML
* R
* getopt
* EMBOSS (transeq)

Each software can be either placed in the PATH or installed with conda, with the exception of phyutility, which can be installed using ```sudo apt-get install phyutility```.
A [```.yml```](https://github.com/for-giobbe/BASE/blob/master/BASE_env.yml) is available to configure a conda environiment with all the dependencies required by BASE. 
You can create the enivironiment using ```conda env create -f BASE_env.yml``` and it can be then recalled using ```conda activate BASE_env```.
The correct installation and versions of the requirements can be checked using the ```--requirements``` option.

During the tutorial we are gonna leverage two toy datasets:

- the [first](https://github.com/for-giobbe/BASE/tree/master/example/example_data/complete_OGs) includes OGs of (single-copy) genens which are ubiquitous 
to the species considered,

- the [second](https://github.com/for-giobbe/BASE/tree/master/example/example_data/partials_OGs) consists of (single-copy) "incomplete" OGs 
where some species are missing.

All the other input files can be found [here](https://github.com/for-giobbe/BASE/tree/master/example/).

---

## Retrive omega values of a specific branch in complete clusters:

To start the first step youse the line:
```BASE.1.9.sh --analyze -i complete_OGs/ -o complete_OGs_analyze -t sp.tre -ma m0.ctl -mb m1.ctl -c 4```

Among the many information which are printed to the standard output, the last line should be:

```the analysis has produced some warning: you will find the information relative to each failure in the file warning_summary.txt```

Inside the  output folder ```complete_OGs_analyze``` you will find a ```warnings_summary.txt```.

If you ```cat``` the file, you can read all the warnings generated by the analysis, such as:

```the gene OG3105.mafft.n.aln contains missing data and has been excluded by the analyses - to include it use the -d flag```


The analysis has also generated a ```.out``` file for each OG, which also state whether the general or alternative model was
the best-fit for the data and - if specified - the best replicate. We'll need these outputs for the following steps

A rather important file is the summary of the LRTs. Type ```column -t complete_OGs_analyze/likelihood_summary.txt``` to take a look at it:

```
Ortholog_Cluster  Model1  NSsites_a  Model1np  Model1LnL      Rep1  Model2  NSsites_a.1  Model2np  Model2LnL     Rep2  LRT      df  p.value  significance
OG3126.mafft.n    0       NA         2         -4132.017209   1     1       NA           12        -4116.792933  1     30.4486  10  7e-04    ***
OG3158.mafft.n    0       NA         2         -3818.030135   1     1       NA           12        -3801.882145  1     32.296   10  4e-04    ***
OG3164.mafft.n    0       NA         2         -5374.980383   1     1       NA           12        -5358.727983  1     32.5048  10  3e-04    ***
OG3196.mafft.n    0       NA         2         -3365.98055    1     1       NA           12        -3355.771214  1     20.4187  10  0.0255   *
OG3197.mafft.n    0       NA         2         -3680.783168   1     1       NA           12        -3671.481767  1     18.6028  10  0.0456   *
OG3302.mafft.n    0       NA         2         -9054.676043   1     1       NA           12        -9028.37395   1     52.6042  10  0        ***
OG3342.mafft.n    0       NA         2         -3444.803353   1     1       NA           12        -3431.378852  1     26.849   10  0.0028   **
OG3347.mafft.n    0       NA         2         -9597.616313   1     1       NA           12        -9586.571185  1     22.0903  10  0.0147   *
OG3359.mafft.n    0       NA         2         -3147.226951   1     1       NA           12        -3126.908131  1     40.6376  10  0        ***
OG3362.mafft.n    0       NA         2         -5722.861684   1     1       NA           12        -5706.727938  1     32.2675  10  4e-04    ***
OG3372.mafft.n    0       NA         2         -3710.675722   1     1       NA           12        -3695.63184   1     30.0878  10  8e-04    ***
OG3387.mafft.n    0       NA         2         -4067.125785   1     1       NA           12        -4057.24774   1     19.7561  10  0.0316   *
OG3395.mafft.n    0       NA         2         -3901.33739    1     1       NA           12        -3841.403883  1     119.867  10  0        ***
OG3399.mafft.n    0       NA         2         -3003.011552   1     1       NA           12        -2990.356715  1     25.3097  10  0.0048   **
OG3600.mafft.n    0       NA         2         -2867.120583   1     1       NA           12        -2844.358272  1     45.5246  10  0        ***
OG3622.mafft.n    0       NA         2         -3407.557493   1     1       NA           12        -3388.589881  1     37.9352  10  0        ***
OG3640.mafft.n    0       NA         2         -3342.883393   1     1       NA           12        -3317.158544  1     51.4497  10  0        ***
OG3648.mafft.n    0       NA         2         -10491.352418  1     1       NA           12        -10484.2421   1     14.2206  10  0.1632   n/s
OG3682.mafft.n    0       NA         2         -3703.868866   1     1       NA           12        -3690.236972  1     27.2638  10  0.0024   **
OG3683.mafft.n    0       NA         2         -2791.481942   1     1       NA           12        -2774.797116  1     33.3697  10  2e-04    ***
```

---

## Retrive omega values of a branch allowing missing data in the group of interest:

analyze m0 vs m2 with missing data
annotate
extract with missing data in the group of interest

---

## Retrive omega values of a branch allowing missing data in the group of interest:

analyze m2 vs m2 with different labeling
annotate
extract with missing data only outside the target group

---

## Compare NSsites model using replicates:

analyze NSsites with replicates
